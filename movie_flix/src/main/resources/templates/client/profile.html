<!DOCTYPE html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{client/layout/layout}">

<head>
    <title th:text="${title}">Hồ sơ của tôi</title>
</head>

<body>
<th:block layout:fragment="content">

    <h2 class="section-title" th:text="${title}">Hồ sơ của tôi</h2>

    <div class="row">
        <div class="col-md-4 mb-4">
            <div class="card bg-dark text-light border-secondary">
                <div class="card-body text-center p-4">
                    <div class="fs-1 mb-3 text-primary">
                        <i class="fas fa-user-circle"></i>
                    </div>

                    <h5 class="card-title mb-1" th:text="${user.email}">user@example.com</h5>

                    <p class="mb-3">
                        <span class="badge"
                              th:classappend="${user.role.name == 'admin'} ? 'badge-danger' : 'badge-info'"
                              th:text="${user.role.name}"></span>
                    </p>
                </div>
            </div>
        </div>

        <div class="col-md-8">
            <ul class="nav nav-pills nav-fill mb-3" id="profileTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="favorites-tab" data-bs-toggle="tab"
                            data-bs-target="#favorites" type="button" role="tab" aria-controls="favorites"
                            aria-selected="true">
                        <i class="fas fa-heart me-2"></i>Phim Yêu Thích
                        <span class="badge bg-danger ms-2" th:text="${#lists.size(user.favorites)}"></span>
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="history-tab" data-bs-toggle="tab" data-bs-target="#history"
                            type="button" role="tab" aria-controls="history" aria-selected="false">
                        <i class="fas fa-history me-2"></i>Lịch sử xem
                        <span class="badge bg-secondary ms-2" th:text="${#lists.size(user.history)}"></span>
                    </button>
                </li>
            </ul>

            <div class="tab-content" id="profileTabsContent">

                <div class="tab-pane fade show active" id="favorites" role="tabpanel"
                     aria-labelledby="favorites-tab">

                    <div th:if="${#lists.isEmpty(user.favorites)}"
                         class="text-center p-5 text-white-50 rounded"
                         style="background-color: rgba(255,255,255,0.05);">
                        <div class="fs-1 mb-3">
                            <i class="fas fa-heart-crack"></i>
                        </div>
                        <h4>Danh sách trống</h4>
                        <p>Bạn chưa có phim yêu thích nào. Hãy khám phá ngay!</p>
                        <a th:href="@{/}" class="btn btn-primary mt-2">
                            <i class="fas fa-search me-2"></i>Tìm phim ngay
                        </a>
                    </div>

                    <div class="row mt-4" th:unless="${#lists.isEmpty(user.favorites)}">
                        <div class="col-md-6 col-lg-6 mb-4" th:each="film : ${user.favorites}">
                            <a th:href="@{/movie/{id}(id=${film.id})}" class="text-decoration-none">
                                <div class="movie-card h-100">
                                    <img th:src="${film.posterUrl}" class="movie-poster w-100"
                                         th:alt="${film.title}"
                                         onerror="this.onerror=null;this.src='https://placehold.co/400x600/222/FFF?text=Image+Not+Found';">
                                    <div class="p-3">
                                        <h5 class="movie-title mb-2" th:text="${film.title}"></h5>
                                        <p class="movie-year small mb-0" th:text="${film.releaseYear}"></p>
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="history" role="tabpanel" aria-labelledby="history-tab">

                    <div th:if="${#lists.isEmpty(user.history)}"
                         class="text-center p-5 text-white-50 rounded"
                         style="background-color: rgba(255,255,255,0.05);">
                        <div class="fs-1 mb-3">
                            <i class="fas fa-film"></i>
                        </div>
                        <h4>Lịch sử trống</h4>
                        <p>Lịch sử xem phim của bạn hiện đang trống.</p>
                        <a th:href="@{/}" class="btn btn-primary mt-2">
                            <i class="fas fa-play me-2"></i>Xem ngay
                        </a>
                    </div>

                    <div class="row mt-4" th:unless="${#lists.isEmpty(user.history)}">
                        <div class="col-md-6 col-lg-6 mb-4" th:each="film : ${user.history}">
                            <a th:href="@{/movie/{id}(id=${film.id})}" class="text-decoration-none">
                                <div class="movie-card h-100">
                                    <img th:src="${film.posterUrl}" class="movie-poster w-100"
                                         th:alt="${film.title}"
                                         onerror="this.onerror=null;this.src='https://placehold.co/400x600/222/FFF?text=Image+Not+Found';">
                                    <div class="p-3">
                                        <h5 class="movie-title mb-2" th:text="${film.title}"></h5>
                                        <p class="movie-year small mb-0" th:text="${film.releaseYear}"></p>
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</th:block>
</body>
</html>